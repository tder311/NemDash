"""Sample NEM price CSV content for testing"""
import io
import zipfile

# DISPATCH price format (version 3 - legacy)
SAMPLE_DISPATCH_PRICE_CSV = b'''C,NEMP.WORLD,,DISPATCH,PRICE,1
I,DISPATCH,PRICE,3,SETTLEMENTDATE,RUNNO,REGIONID,DISPATCHINTERVAL,RRP,EEP,ROP,APCFLAG
D,DISPATCH,PRICE,3,"2025/01/15 10:30:00",1,NSW1,0,85.50,0,0,0
D,DISPATCH,PRICE,3,"2025/01/15 10:30:00",1,VIC1,0,72.30,0,0,0
D,DISPATCH,PRICE,3,"2025/01/15 10:30:00",1,QLD1,0,65.10,0,0,0
D,DISPATCH,PRICE,3,"2025/01/15 10:30:00",1,SA1,0,95.20,0,0,0
D,DISPATCH,PRICE,3,"2025/01/15 10:30:00",1,TAS1,0,55.00,0,0,0
D,DISPATCH,REGIONSUM,3,"2025/01/15 10:30:00",1,NSW1,0,85.50,0,7500.0,0,0,0
D,DISPATCH,REGIONSUM,3,"2025/01/15 10:30:00",1,VIC1,0,72.30,0,5200.0,0,0,0
D,DISPATCH,REGIONSUM,3,"2025/01/15 10:30:00",1,QLD1,0,65.10,0,6800.0,0,0,0
D,DISPATCH,REGIONSUM,3,"2025/01/15 10:30:00",1,SA1,0,95.20,0,2100.0,0,0,0
D,DISPATCH,REGIONSUM,3,"2025/01/15 10:30:00",1,TAS1,0,55.00,0,1200.0,0,0,0
C,END OF REPORT,,,
'''

# DISPATCH price format (version 5 - current NEMWEB format with INTERVENTION column)
SAMPLE_DISPATCH_PRICE_CSV_V5 = b'''C,NEMP.WORLD,,DISPATCH,PRICE,1
I,DISPATCH,PRICE,5,SETTLEMENTDATE,RUNNO,REGIONID,DISPATCHINTERVAL,INTERVENTION,RRP,EEP,ROP,APCFLAG
D,DISPATCH,PRICE,5,"2025/01/15 10:30:00",1,NSW1,0,0,85.50,0,0,0
D,DISPATCH,PRICE,5,"2025/01/15 10:30:00",1,VIC1,0,0,72.30,0,0,0
D,DISPATCH,PRICE,5,"2025/01/15 10:30:00",1,QLD1,0,0,65.10,0,0,0
D,DISPATCH,PRICE,5,"2025/01/15 10:30:00",1,SA1,0,0,95.20,0,0,0
D,DISPATCH,PRICE,5,"2025/01/15 10:30:00",1,TAS1,0,0,55.00,0,0,0
D,DISPATCH,REGIONSUM,5,"2025/01/15 10:30:00",1,NSW1,0,0,85.50,0,7500.0,0,0,0
D,DISPATCH,REGIONSUM,5,"2025/01/15 10:30:00",1,VIC1,0,0,72.30,0,5200.0,0,0,0
D,DISPATCH,REGIONSUM,5,"2025/01/15 10:30:00",1,QLD1,0,0,65.10,0,6800.0,0,0,0
D,DISPATCH,REGIONSUM,5,"2025/01/15 10:30:00",1,SA1,0,0,95.20,0,2100.0,0,0,0
D,DISPATCH,REGIONSUM,5,"2025/01/15 10:30:00",1,TAS1,0,0,55.00,0,1200.0,0,0,0
C,END OF REPORT,,,
'''

# TRADING price format
SAMPLE_TRADING_PRICE_CSV = b'''C,NEMP.WORLD,,TRADING,PRICE,1
I,TRADING,PRICE,3,SETTLEMENTDATE,RUNNO,REGIONID,PERIODID,RRP,EEP,INVALIDFLAG,LASTCHANGED,ROP,APCFLAG
D,TRADING,PRICE,3,"2025/01/15 10:30:00",1,NSW1,167,85.50,0,0,"2025/01/15 10:30:05",85.50,0
D,TRADING,PRICE,3,"2025/01/15 10:30:00",1,VIC1,167,72.30,0,0,"2025/01/15 10:30:05",72.30,0
D,TRADING,PRICE,3,"2025/01/15 10:30:00",1,QLD1,167,65.10,0,0,"2025/01/15 10:30:05",65.10,0
D,TRADING,PRICE,3,"2025/01/15 10:30:00",1,SA1,167,-50.25,0,0,"2025/01/15 10:30:05",-50.25,0
D,TRADING,PRICE,3,"2025/01/15 10:30:00",1,TAS1,167,55.00,0,0,"2025/01/15 10:30:05",55.00,0
D,TRADING,REGIONSUM,3,"2025/01/15 10:30:00",1,NSW1,167,85.50,0,7500.0,0,0
D,TRADING,REGIONSUM,3,"2025/01/15 10:30:00",1,SA1,167,-50.25,0,2100.0,0,0
C,END OF REPORT,,,
'''

# PUBLIC (DREGION) price format
SAMPLE_PUBLIC_PRICE_CSV = b'''C,NEMP.WORLD,,DREGION,1
I,DREGION,,2,SETTLEMENTDATE,RUNNO,REGIONID,INTERVENTION,RRP,EEP,ROP,APCFLAG,MARKETSUSPENDEDFLAG,TOTALDEMAND
D,DREGION,,2,"2025/01/15 10:30:00",1,NSW1,0,85.50,0,85.50,0,0,7500.0,0
D,DREGION,,2,"2025/01/15 10:30:00",1,VIC1,0,72.30,0,72.30,0,0,5200.0,0
D,DREGION,,2,"2025/01/15 10:30:00",1,QLD1,0,65.10,0,65.10,0,0,6800.0,0
D,DREGION,,2,"2025/01/15 10:30:00",1,SA1,0,-50.25,0,-50.25,0,0,2100.0,0
D,DREGION,,2,"2025/01/15 10:30:00",1,TAS1,0,55.00,0,55.00,0,0,1200.0,0
C,END OF REPORT,,,
'''

# Price CSV with no records
SAMPLE_PRICE_NO_RECORDS = b'''C,NEMP.WORLD,,OTHER,DATA,1
D,OTHER,DATA,val1,val2
C,END OF REPORT,,,
'''

# Directory listings
SAMPLE_DISPATCH_PRICE_DIR = '''<a href="PUBLIC_DISPATCHIS_202501151025_0000000123456789.zip">file1</a>
<a href="PUBLIC_DISPATCHIS_202501151030_0000000123456790.zip">file2</a>'''

SAMPLE_TRADING_DIR = '''<a href="PUBLIC_TRADINGIS_202501151025_0000000123456789.zip">file1</a>
<a href="PUBLIC_TRADINGIS_202501151030_0000000123456790.zip">file2</a>'''

SAMPLE_PUBLIC_PRICES_DIR = '''<a href="PUBLIC_PRICES_202501150000_00000000000001.zip">file1</a>
<a href="PUBLIC_PRICES_202501150000_00000000000002.zip">file2</a>'''

SAMPLE_IRSR_DIR = '''<a href="PUBLIC_IRSR_202501151030_0000000123456789.zip">file</a>'''

SAMPLE_IRSR_DIR_ALT = '''<a href="PUBLIC_DISPATCH_IRSR_202501151030_0000000123456789.zip">file</a>'''

# Directory listing with multiple dispatch files (for backfill testing)
SAMPLE_DISPATCH_PRICE_DIR_MULTI = '''<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<body>
<a href="PUBLIC_DISPATCHIS_202501150400_0000000123456780.zip">file1</a>
<a href="PUBLIC_DISPATCHIS_202501150405_0000000123456781.zip">file2</a>
<a href="PUBLIC_DISPATCHIS_202501150410_0000000123456782.zip">file3</a>
<a href="PUBLIC_DISPATCHIS_202501150415_0000000123456783.zip">file4</a>
<a href="PUBLIC_DISPATCHIS_202501150420_0000000123456784.zip">file5</a>
</body>
</html>'''

# Sample dispatch price CSV for a specific timestamp (for multi-file testing)
def create_dispatch_price_csv_for_time(timestamp: str) -> bytes:
    """Create sample dispatch price CSV for a specific timestamp"""
    return f'''C,NEMP.WORLD,,DISPATCH,PRICE,1
I,DISPATCH,PRICE,3,SETTLEMENTDATE,RUNNO,REGIONID,DISPATCHINTERVAL,RRP,EEP,ROP,APCFLAG
D,DISPATCH,PRICE,3,"{timestamp}",1,NSW1,0,85.50,0,0,0
D,DISPATCH,PRICE,3,"{timestamp}",1,VIC1,0,72.30,0,0,0
D,DISPATCH,PRICE,3,"{timestamp}",1,QLD1,0,65.10,0,0,0
D,DISPATCH,PRICE,3,"{timestamp}",1,SA1,0,95.20,0,0,0
D,DISPATCH,PRICE,3,"{timestamp}",1,TAS1,0,55.00,0,0,0
D,DISPATCH,REGIONSUM,3,"{timestamp}",1,NSW1,0,85.50,0,7500.0,0,0,0
D,DISPATCH,REGIONSUM,3,"{timestamp}",1,VIC1,0,72.30,0,5200.0,0,0,0
D,DISPATCH,REGIONSUM,3,"{timestamp}",1,QLD1,0,65.10,0,6800.0,0,0,0
D,DISPATCH,REGIONSUM,3,"{timestamp}",1,SA1,0,95.20,0,2100.0,0,0,0
D,DISPATCH,REGIONSUM,3,"{timestamp}",1,TAS1,0,55.00,0,1200.0,0,0,0
C,END OF REPORT,,,
'''.encode('utf-8')


def create_price_zip(csv_content: bytes, price_type: str = 'DISPATCH') -> bytes:
    """Create a sample price ZIP file for testing"""
    buffer = io.BytesIO()
    with zipfile.ZipFile(buffer, 'w', zipfile.ZIP_DEFLATED) as zf:
        if price_type == 'DISPATCH':
            zf.writestr('PUBLIC_DISPATCHIS_202501151030.CSV', csv_content)
        elif price_type == 'TRADING':
            zf.writestr('PUBLIC_TRADINGIS_202501151030.CSV', csv_content)
        else:
            zf.writestr('PUBLIC_PRICES_202501150000.CSV', csv_content)
    return buffer.getvalue()
